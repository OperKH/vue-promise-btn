import e from"vue";var n=function(e,n,t,i,r,o,s,a,d,p){"boolean"!=typeof s&&(d=a,a=s,s=!1);var c,u="function"==typeof t?t.options:t;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,r&&(u.functional=!0)),i&&(u._scopeId=i),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,d(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},u._ssrRegister=c):n&&(c=s?function(){n.call(this,p(this.$root.$options.shadowRoot))}:function(e){n.call(this,a(e))}),c)if(u.functional){var l=u.render;u.render=function(e,n){return c.call(n),l(e,n)}}else{var f=u.beforeCreate;u.beforeCreate=f?[].concat(f,c):[c]}return t}({render:function(){var e=this.$createElement;return(this._self._c||e)("span",{staticClass:"spinner",style:this.style})},staticRenderFns:[]},void 0,{name:"Spinner",props:{color:{type:String,default:"#3498db"},size:{type:Number,default:18},width:{type:Number,default:4},duration:{type:String,default:"1s"}},computed:{style:function(){return{borderTopColor:this.color,width:this.size+"px",height:this.size+"px",borderWidth:this.width+"px",animationDuration:this.duration}}}},"data-v-cc3e8e04",!1,void 0,void 0,void 0),t=0,i=function(n){var i={listeners:{},init:function(r,o,s){var a,d=(a=o.value)===Object(a),p=r.$promiseBtnId=t++,c=d?o.value:{},u=Object.assign({},n,c),l=s.data.on&&s.data.on[u.action]&&(s.data.on[u.action]._withTask||s.data.on[u.action]._wrapper),f=function(e){return"string"==typeof e}(u.loader),h=r,v=null,b=!1,m=!1,w=function(){b&&m&&(v.show=!1,b=!1,m=!1,function(e,n){e.getAttribute("disabled")&&n.disableBtn&&e.removeAttribute("disabled"),e.classList.remove(n.btnLoadingClass)}(h,u))},_=function(){g=!1,u.showSpinner&&(m=!0,w())};if(i.listeners[p]={el:r,eventType:u.action,handler:l},r.removeEventListener(u.action,l),!l)throw new Error("Please, provide proper handler/action for promise-btn");if("submit"===u.action&&!(h=r.querySelector('[type="submit"]')))throw new Error("No submit button found");if(u.showSpinner){var y=function(n,t,i,r){var o=document.createElement("SPAN");n.appendChild(o);var s={el:o,data:{show:!1},props:{parent:{type:Object,default:function(){return i.context}}},render:t.componentRenderer(t)};if(r){var a=t.stringHTMLRenderer(t),d=e.compile(a);s=Object.assign({},s,{data:Object.assign({},s.data,{options:t}),render:d.render,staticRenderFns:d.staticRenderFns})}return s}(h,u,s,f);v=new e(y)}var g=!1;i.listener=function(e){if(!u.disableBtn||!g){var n,t=l(e),i="function"==typeof t?function(e){for(var n=e;"function"==typeof n;)n=n();return n}(t):t;!(n=i)||"object"!=typeof n&&"function"!=typeof n||"function"!=typeof n.then||(g=!0,function(e,n){n.disableBtn&&e.setAttribute("disabled","disabled"),e.classList.add(n.btnLoadingClass)}(h,u),u.showSpinner&&(v.show=!0,setTimeout(function(){b=!0,w()},u.minTimeout)),i.then(_).catch(function(e){throw _(),e}))}}},bind:function(e,n,t){var r;(r=n.def).init.apply(r,arguments);var o=e.$promiseBtnId,s=i.listeners[o].eventType;e.addEventListener(s,i.listener)},unbind:function(e,n){var t=e.$promiseBtnId,r=i.listeners[t].eventType;e.removeEventListener(r,i.listener),delete i.listeners[t],delete e.$promiseBtnId}};return i},r={btnLoadingClass:"loading",showSpinner:!0,action:"click",disableBtn:!0,stringHTMLRenderer:function(e){return'\n  <span class="promise-btn__spinner-wrapper" \n        :class="{[options.spinnerHiddenClass]: !show || false}"\n        v-show="options.autoHideSpinnerWrapper ? show : true"\n  >\n    '+e.loader+"\n  </span>"},componentRenderer:function(e){return function(n){var t;return n("span",{class:(t={"promise-btn__spinner-wrapper":!0},t[e.spinnerHiddenClass]=!!e.spinnerHiddenClass&&!this.show,t),directives:[{name:"show",value:!e.autoHideSpinnerWrapper||this.show}]},[n(e.loader)])}},minTimeout:400,spinnerHiddenClass:"hidden",autoHideSpinnerWrapper:!1,loader:n};export default{install:function(e,n){var t=Object.assign({},r,n);e.directive("promise-btn",i(t))},Spinner:n,setupVuePromiseBtn:i};
